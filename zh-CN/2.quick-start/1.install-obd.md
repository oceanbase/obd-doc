# 安装并配置 OBD

本文介绍如何安装 OBD，以及安装成功后如何配置 OBD。

## 安装 OBD

### 使用 RPM 包安装

#### 在线安装

若您的机器可以连接网络，在 CentOS 或 RedHat 系统上，您可执行以下命令在线安装 OBD。

```shell
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://mirrors.aliyun.com/oceanbase/OceanBase.repo
sudo yum install -y ob-deploy
source /etc/profile.d/obd.sh
```

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>YUM 命令默认安装最新版本，您可通过声明版本号安装指定版本，如使用 <code>yum install -y ob-deploy-1.6.2</code> 命令安装 OBD V1.6.2，推荐安装最新版本。</p>
</main>

#### 离线安装

若您的机器无法连接网络，您可从 [OceanBase 软件下载中心](https://www.oceanbase.com/softwarecenter) 下载所需版本的 OBD。下载完成后，将 OBD 复制到您的中控机器上。推荐您使用最新版本的安装包。

在 CentOS 或 RedHat 系统上，执行如下命令安装 OBD：

```bash
sudo yum install ob-deploy-*.rpm
```

在 Ubuntu 或 Debian 系统上，执行如下命令安装 OBD：

```bash
sudo alien --scripts -i ob-deploy-*.rpm
```

### 使用 all-in-one 安装包安装 OBD

OceanBase 从 V4.0.0 开始提供统一的安装包 all-in-one package。您可以通过这个统一的安装包一次性完成 OBD、OceanBase 数据库、ODP、OBAgent、Grafana、Prometheus 和 OCP Express 的安装。

#### 在线安装

若您的机器可以连接网络，可执行如下命令在线安装。

```bash
bash -c "$(curl -s https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/download-center/opensource/oceanbase-all-in-one/installer.sh)"
source ~/.oceanbase-all-in-one/bin/env.sh
```

#### 离线安装

若您的机器无法连接网络，可参考如下步骤离线安装。

1. 从 [OceanBase 软件下载中心](https://www.oceanbase.com/softwarecenter) 下载最新的 all-in-one 安装包，并将其复制到中控机中。推荐使用最新版本的安装包

2. 在安装包所在目录下执行如下命令解压安装包并安装。

   ```bash
   tar -xzf oceanbase-all-in-one-*.tar.gz
   cd oceanbase-all-in-one/bin/
   ./install.sh
   source ~/.oceanbase-all-in-one/bin/env.sh
   ```

### 使用源码安装

在使用源码安装 OBD 之前，请您确认已安装以下依赖：

* gcc

* wget

* python-devel

* openssl-devel

* xz-devel

* mysql-devel

Python2.7 环境下使用以下命令安装：

```shell
sh rpm/build.sh build
source /etc/profile.d/obd.sh
```

Python3.8 环境下需按以下步骤安装：

1. 在 Python2.7 环境下执行以下命令。

   ```shell
   sh rpm/build.sh executer
   ```

2. 在 Python3.8 环境下执行以下命令。

   ```shell
   sh rpm/build.sh build_obd
   source /etc/profile.d/obd.sh
   ```

## 配置 OBD

### 在线配置

当机器可以连接网络时，执行如下命令添加 OceanBase 数据库的仓库即可，OBD 部署时会从仓库中自动下载所需软件。

```bash
sudo yum-config-manager --add-repo https://mirrors.aliyun.com/oceanbase/OceanBase.repo
```

您可执行如下命令查看 OceanBase.repo 内容。

```bash
cat /etc/yum.repos.d/OceanBase.repo

# 输出：
# OceanBase.repo

[oceanbase.community.stable]
name=OceanBase-community-stable-el$releasever
baseurl=http://mirrors.aliyun.com/oceanbase/community/stable/el/$releasever/$basearch/
enabled=1
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/oceanbase/RPM-GPG-KEY-OceanBase

[oceanbase.development-kit]
name=OceanBase-development-kit-el$releasever
baseurl=http://mirrors.aliyun.com/oceanbase/development-kit/el/$releasever/$basearch/
enabled=1
gpgcheck=1
gpgkey=http://mirrors.aliyun.com/oceanbase/RPM-GPG-KEY-OceanBase
```

### 离线配置

当您的机器无法连接网络时，您需提前下载好所需软件的安装包，并将其添加到 OBD 的本地仓库。

下载地址：

* [Redhat/CentOS 7.x](https://mirrors.aliyun.com/oceanbase/community/stable/el/7/x86_64)

* [Redhat/CentOS 8.x](https://mirrors.aliyun.com/oceanbase/community/stable/el/8/x86_64)

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>请根据实际需求下载软件包，建议使用最新版本的软件。</p>
</main>

#### 将安装包添加到本地仓库

在部署运行 OBD 的操作系统用户下按照如下步骤操作，示例中使用的是用户 admin。

1. 执行如下命令禁用远程仓库

   ```bash
   obd  mirror disable remote
   ```

   禁用后可通过 `obd mirror list` 命令进行确认，查看 Type=remote 对应的 `Enabled` 变成了 `False`，说明已关闭远程镜像源

2. 在安装包所在目录执行如下命令将下载好的安装包上传到本地仓库

   ```bash
   obd mirror clone *.rpm
   ```

3. 查看本地仓库的安装包列表

   ```bash
   obd mirror list local
   ```

   在输出的列表中查看到部署所需安装包即表示上传成功。
