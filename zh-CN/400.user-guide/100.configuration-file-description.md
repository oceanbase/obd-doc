# 配置文件说明

本文介绍 OBD 中的配置文件，以及配置文件中各个配置项的含义。

## 获取配置文件示例

OBD 提供了部署集群所需的配置文件示例，您可根据自身机器资源情况进行修改。

* 若您机器中的 OBD 是通过直接下载的方式安装，则可在 `/usr/obd/example` 目录下查看 OBD 提供的配置文件示例。

* 若您机器中的 OBD 是通过解压 all-in-one 安装包的方式安装，则可在 `~/.oceanbase-all-in-one/conf` 目录下查看 OBD 提供的配置文件示例。

* 您也可在 OBD 的 [GitHub 仓库](https://github.com/oceanbase/obdeploy/tree/master/example) 中查看配置文件示例。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>配置文件分为小规格开发和专业开发两种模式，两种模式的配置文件中配置项基本相同，配置的规格略有不同，您可根据实际资源条件进行选择。</p>
  <ul>
  <li>
  <p>小规格开发模式：适用于个人设备（内存不低于 8 GB），配置文件名中带有 <code>mini</code> 或 <code>min</code> 标识。</p>
  </li>
  <li>
  <p>专业开发模式：适用于高配置 ECS 或物理服务器（可用资源不低于 16 核 64 GB）。</p>
  </li>
  </ul>
</main>

部署 OceanBase 数据库时常用的配置文件有如下几个。

| 配置文件  |  说明    | 包含组件    |
|----------|----------|------------|
| `mini-local-example.yaml`/`local-example.yaml`  | 本地单机部署配置文件示例，无需配置用户信息，可在本地单机部署一个 OceanBase 数据库  | OceanBase 数据库   |
| `mini-single-example.yaml`/`single-example.yaml` | 单机部署配置文件示例，需要配置用户信息，可在任意一台机器中单机部署一个 OceanBase 数据库   | OceanBase 数据库 |
| `mini-single-with-obproxy-example.yaml`/`single-with-obproxy-example.yaml` | 单机部署 + ODP 配置文件示例  | OceanBase 数据库、ODP（又称为 OBProxy，后文统称为 ODP）  |
| `mini-distributed-example.yaml`/`distributed-example.yaml` | 分布式部署配置文件示例  | OceanBase 数据库  |
| `mini-distributed-with-obproxy-example.yaml`/`distributed-with-obproxy-example.yaml` | 分布式部署 + ODP 配置文件示例 | OceanBase 数据库、ODP |
| `default-components-min.yaml`/`default-components.yaml`  | 分布式部署 + ODP + OCP Express 配置样例 | OceanBase 数据库、ODP、OBAgent、OCP Express  |
| `all-components-min.yaml`/`all-components.yaml`  | 分布式部署全部组件  | OceanBase 数据库、ODP、OBAgent、OCP Express、Prometheus、Grafana |

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>若您计划部署 OCP Express，则无需部署 Prometheus 和 Grafana。</p>
</main>

除上述配置文件之外，example 目录下有不同的文件夹存放不同的配置文件示例，以方便应对各种场景，具体内容如下。

* **autodeploy**：该目录下的配置文件示例是为 [obd cluster autodeploy](../300.obd-command/100.cluster-command-groups.md) 命令准备的，您只需修改配置文件示例中的 IP 和目录，OBD 会根据目标机器资源自动生成最大规格的完整配置并部署启动集群。

* **grafana**：该目录下的配置文件示例是为部署 Grafana 准备的，您可使用这些配置文件示例单独部署 Grafana，或同时部署 Grafana 和 Prometheus。

* **obagent**：该目录下的配置文件示例是为部署 OBAgent 准备的，您可根据自己希望部署的 OBAgent 版本选择对应的配置文件示例部署 OBAgent。

* **obproxy**：该目录下的配置文件示例是为部署 ODP 准备的，您可使用这些配置文件示例单独部署 ODP，或部署 OceanBase 数据库和 ODP。

* **oceanbase-3.x**：该目录下的配置文件是适配 3.x 版本 OceanBase 数据库的配置文件示例。

* **ocp-express**：该目录下的配置文件示例是为部署 OCP Express 准备的，您可使用这些配置文件示例单独部署 OCP Express。

* **prometheus**：该目录下的配置文件示例是为部署 Prometheus 准备的，您可使用这些配置文件示例单独部署Prometheus，或同时部署 OceanBase 数据库、OBAgent 和 Prometheus。

## 配置文件格式

OBD 中的配置文件有其固定格式，下面讲解配置文件中不同模块的含义。

```yaml
# Only need to configure when remote login is required
# user:   # ssh 登录配置
#   username: your username
#   password: your password if need
#   key_file: your ssh-key file path if need
#   port: your ssh port, default 22
#   timeout: ssh connection timeout (second), default 30
oceanbase-ce:  # 组件名，其下内容是对该组件的配置
  servers:  # 节点列表
    - name: z1  # name 后可不填，不填默认节点名与 IP 相同，这里指该节点名为 z1
      # Please don't use hostname, only IP can be supported
      ip: 10.10.10.1
    - name: z2
      ip: 10.10.10.2
    - name: z3
      ip: 10.10.10.3
  global:  # 全局配置，同一组件中相同的配置可以写在这里
           # 如果节点的配置中有与全局配置相同的配置项，则使用节点的配置
    devname: eth0
    ......
    # 省略具体配置项
  # In this example, support multiple ob process in single node, so different process use different ports.
  # If deploy ob cluster in multiple nodes, the port and path setting can be same.
  z1:  # 节点配置，这里是对 z1 节点的配置，也就是 10.10.10.1 这台服务器，节点的配置优先级是最高的。
    mysql_port: 2881 # External port for OceanBase Database. The default value is 2881.
    rpc_port: 2882 # Internal port for OceanBase Database. The default value is 2882.
    #  The working directory for OceanBase Database. OceanBase Database is started under this directory. This is a required field.
    home_path: /home/admin/observer
    zone: zone1
  z2:  # 节点配置，这里是对 z2 节点的配置，也就是 10.10.10.2 这台服务器。
    mysql_port: 2881 # External port for OceanBase Database. The default value is 2881.
    rpc_port: 2882 # Internal port for OceanBase Database. The default value is 2882.
    #  The working directory for OceanBase Database. OceanBase Database is started under this directory. This is a required field.
    home_path: /home/admin/observer
    zone: zone2
  z3:   # 节点配置，这里是对 z3 节点的配置，也就是 10.10.10.3 这台服务器。
    mysql_port: 2881 # External port for OceanBase Database. The default value is 2881.
    rpc_port: 2882 # Internal port for OceanBase Database. The default value is 2882.
    #  The working directory for OceanBase Database. OceanBase Database is started under this directory. This is a required field.
    home_path: /home/admin/observer
    zone: zone3
```

各模块介绍如下。

| 模块名    | 说明        |
|----------|--------------|
| user     | 配置用户信息，建议使用 admin 用户。该模块下需关注的配置项介绍如下：<ul><li>`username` 为登录到目标机器的用户名，确保您的用户名有 `home_path` 的写权限。</li><li>`password` 和 `key_file` 均用于验证用户，通常情况下只需要填写一个。</li></ul> <blockquote>**注意**</br>在配置秘钥路径后，如果您的秘钥不需要口令，请注释或者删除 `password`，以免 `password` 被视为秘钥口令用于登录，导致校验失败。</blockquote>  |
| oceanbase-ce | 组件名，其下的内容是对该组件的配置。 |
| servers  | 节点信息，每台机器需要用 `- name: 机器标识名 (换行)ip: 机器 IP` 指定，多个机器就指定多次，机器标识名不能重复。</br>在机器 IP 不重复的情况下，也可以使用 `- <ip> （换行）- <ip>` 的格式指定，此时 `- <ip>` 的格式相当于 `- name: 机器 IP（换行）ip: 机器 IP`。   |
| global  | 表示其下配置为全局配置，同一组件中相同的配置可以写在这里。如果节点的配置中有与全局配置相同的配置项，则使用节点中配置项的配置。  |
| z1     | 表示其下配置为节点配置，此处是以 z1 为例，您需修改为 servers 下配置的 name 名，这里表示对 10.10.10.1 这台服务器。<blockquote>**说明**</br>节点的配置优先级是最高的。<blockquote>  |

## 配置项说明

本节介绍配置文件中的各个组件涉及到的配置项。

:::tab
tab OceanBase 数据库

此处以 `example/distributed-with-obproxy-example.yaml` 文件中 oceanbase-ce 组件部分为例介绍部署 OceanBase 数据库时需注意的配置项。

```yaml
oceanbase-ce:
  # version: 4.2.0.0
  # package_hash: 1cbd1fde8c6d7695015265da09738478c97e0e2f908fca6745dc9cc531860e74
  # tag: dev
  servers:
    - name: server1
      # Please don't use hostname, only IP can be supported
      ip: 10.10.10.1
    - name: server2
      ip: 10.10.10.2
    - name: server3
      ip: 10.10.10.3
  global:
    # Please set devname as the network adaptor's name whose ip is  in the setting of severs.
    # if set severs as "127.0.0.1", please set devname as "lo"
    # if current ip is 192.168.1.10, and the ip's network adaptor's name is "eth0", please use "eth0"
    devname: eth0
    # if current hardware's memory capacity is smaller than 50G, please use the setting of "mini-single-example.yaml" and do a small adjustment.
    memory_limit: 64G # The maximum running memory for an observer
    # The reserved system memory. system_memory is reserved for general tenants. The default value is 30G.
    system_memory: 30G
    datafile_size: 192G # Size of the data file. 
    datafile_next: 200G # the auto extend step. Please enter an capacity, such as 2G
    datafile_maxsize: 1T # the auto extend max size. Please enter an capacity, such as 20G
    log_disk_size: 192G # The size of disk space used by the clog files.
    enable_syslog_wf: false # Print system logs whose levels are higher than WARNING to a separate log file. The default value is true.
    enable_syslog_recycle: true # Enable auto system log recycling or not. The default value is false.
    max_syslog_file_count: 4 # The maximum number of reserved log files before enabling auto recycling. The default value is 0.
    # observer cluster name, consistent with obproxy's cluster_name
    appname: obcluster
    root_password: ****** # root user password
    proxyro_password: ****** # proxyro user pasword, consistent with obproxy's observer_sys_password, can be empty
  # In this example , support multiple ob process in single node, so different process use different ports.
  # If deploy ob cluster in multiple nodes, the port and path setting can be same. 
  server1:
    mysql_port: 2881 # External port for OceanBase Database. The default value is 2881. DO NOT change this value after the cluster is started.
    rpc_port: 2882 # Internal port for OceanBase Database. The default value is 2882. DO NOT change this value after the cluster is started.
    # The working directory for OceanBase Database. OceanBase Database is started under this directory. This is a required field.
    home_path: /home/admin/observer
    # The directory for data storage. The default value is $home_path/store.
    # data_dir: /data
    # The directory for clog, ilog, and slog. The default value is the same as the data_dir value.
    # redo_dir: /redo
    zone: zone1
  server2:
    mysql_port: 2881 # External port for OceanBase Database. The default value is 2881. DO NOT change this value after the cluster is started.
    rpc_port: 2882 # Internal port for OceanBase Database. The default value is 2882. DO NOT change this value after the cluster is started.
    #  The working directory for OceanBase Database. OceanBase Database is started under this directory. This is a required field.
    home_path: /home/admin/observer
    # The directory for data storage. The default value is $home_path/store.
    # data_dir: /data
    # The directory for clog, ilog, and slog. The default value is the same as the data_dir value.
    # redo_dir: /redo
    zone: zone2
  server3:
    mysql_port: 2881 # External port for OceanBase Database. The default value is 2881. DO NOT change this value after the cluster is started.
    rpc_port: 2882 # Internal port for OceanBase Database. The default value is 2882. DO NOT change this value after the cluster is started.
    #  The working directory for OceanBase Database. OceanBase Database is started under this directory. This is a required field.
    home_path: /home/admin/observer
    # The directory for data storage. The default value is $home_path/store.
    # data_dir: /data
    # The directory for clog, ilog, and slog. The default value is the same as the data_dir value.
    # redo_dir: /redo
    zone: zone3
```

您需关注的配置项如下表所示，详细的配置项介绍可参见 [OceanBase 数据库配置项](https://github.com/oceanbase/obdeploy/blob/master/plugins/oceanbase/4.2.0.0/parameter.yaml)。

|  配置项  |  是否必选  |  默认值  |  说明     |
|----------|-----------|----------|----------|
| version  | 可选      | 默认部署最新版本 | 指定待部署组件版本，通常情况下不需要指定。    |
| package_hash | 可选  | 默认部署最新版本 | 指定待部署组件 hash，通常情况下不需要指定。        |
| tag      | 可选      | 无        | 指定待部署组件 tag，通常情况下不需要指定。当您为自己编译的 OceanBase 数据库安装包设置了 tag 时，可以适用 tag 来指定。         |
| servers  | 必选      | 无        | 每台机器需要用 `- name: 机器标识名 (换行)ip: 机器 IP` 指定，多个机器就指定多次，机器标识名不能重复。</br> 在机器 IP 不重复的情况下，也可以使用 `- <ip> （换行）- <ip>` 的格式指定，此时 `- <ip>` 的格式相当于 `- name: 机器 IP（换行）ip: 机器 IP`。 |
| devname  | 可选      | 无        | 和 `servers` 里指定的 IP 对应的网卡，通过 `ip addr` 命令可以查看 IP 和网卡对应关系。 |
| memory_limit  | 可选      | 0       | observer 进程能从环境中获取的最大内存，未配置的情况下以 `memory_limit_percentage` 配置项为准，配置项详细介绍请参考 [memory_limit](https://www.oceanbase.com/docs/common-oceanbase-database-1000000000035168) 和 [memory_limit_percentage](https://www.oceanbase.com/docs/common-oceanbase-database-1000000000035169)。 |
| system_memory  | 可选      | 0M        | 保留的系统内存，该参数值会占用 `memory_limit` 的内存，未配置的情况下 OceanBase 数据库会自适应。 |
| datafile_size  | 可选      | 0        | 指定对应节点数据文件（block_file）大小，未配置的情况下以 `datafile_disk_percentage` 配置项为准，详细介绍请参见 [datafile_size](https://www.oceanbase.com/docs/common-oceanbase-database-1000000000035159) 和 [datafile_disk_percentage](https://www.oceanbase.com/docs/common-oceanbase-database-1000000000035234)。 |
| datafile_next  | 可选  | 0       | 控制磁盘空间的增长步长，用于设置自动扩容，未配置的情况下若要开启自动扩容功能可参见 [配置磁盘数据文件的动态扩容](https://www.oceanbase.com/docs/common-oceanbase-database-1000000000033620)。 |
| datafile_maxsize  | 可选  | 0      | 限制磁盘空间的最大可用上限，用于设置自动扩容，未配置的情况下若要开启自动扩容功能可参见 [配置磁盘数据文件的动态扩容](https://www.oceanbase.com/docs/common-oceanbase-database-1000000000033620)。 |
| log_disk_size  | 可选      | 0        | 用于设置 Redo 日志磁盘的大小，未配置的情况下以`log_disk_percentage` 配置项为准，详细介绍请参考 [log_disk_size](https://www.oceanbase.com/docs/common-oceanbase-database-1000000000035368) 和 [log_disk_percentage](https://www.oceanbase.com/docs/common-oceanbase-database-1000000000035324)。 |
| enable_syslog_wf  | 可选      | true      | 设置是否把 WARN 以上级别的系统日志打印到一个单独的日志文件中。 |
| enable_syslog_recycle  | 可选      | false        | 指定是否自动回收系统日志，需要和 `max_syslog_file_count` 参数搭配使用，当 `max_syslog_file_count` 设置为非 0 值时才会生效。 |
| max_syslog_file_count  | 可选      | 0        | 设置在回收日志文件之前可以容纳的日志文件数量。值为 0 时表示不自动清理。 |
| appname     | 可选      | obcluster   | OceanBase 集群名。                   |
| mysql_port  | 必选      | 2881        | 设置 SQL 服务协议端口号，默认为 2881。 |
| rpc_port  | 必选      | 2882       | 设置远程访问的协议端口号，是 observer 进程跟其他节点进程之间的 RPC 通信端口，默认为 2882。 |
| home_path  | 必选      | 无       | OceanBase 数据库默认安装路径，建议在普通用户 admin 下。 |
| data_dir  | 可选      | $home_path/store       | 设置存储 SSTable 等数据的目录，建议配置为独立的磁盘。 |
| redo_dir  | 可选      | 默认与 `data_dir` 相同       | clog、ilog 和 slog 的目录，默认与 data_dir 值相同，建议配置为独立的磁盘。 |
| root_password  | 可选      | OBD V2.0.0 及之前版本默认为空</br>OBD V2.1.0 及之后版本默认为随机字符串       | OceanBase 集群的超级管理员（root@sys）的密码，建议设置复杂的密码。使用 OBD V2.1.0 及之后版本时，未设置的情况下会自动生成随机字符串。 |
| proxyro_password  | 可选      | OBD V2.0.0 及之前版本默认为空</br>OBD V2.1.0 及之后版本默认为随机字符串      | ODP 连接 OceanBase 集群使用的账户名（proxyro@sys）的密码。使用 OBD V2.1.0 及之后版本时，未设置的情况下会自动生成随机字符串。 |
| zone   | 必选  | zone1  | OBServer 节点所在的 Zone 名字。 |

tab ODP

此处以 `example/obproxy/obproxy-only-example.yaml` 文件为例介绍部署 ODP 时需注意的配置项。

```yaml
obproxy-ce:
  servers:
    - 10.10.10.4
  global:
    listen_port: 2883 # External port. The default value is 2883.
    prometheus_listen_port: 2884 # The Prometheus port. The default value is 2884.
    home_path: /home/admin/obproxy
    # oceanbase root server list
    # format: ip:mysql_port;ip:mysql_port. When a depends exists, OBD gets this value from the oceanbase-ce of the depends.
    rs_list: 10.10.10.1:2881;10.10.10.2:2881;10.10.10.3:2881
    # obproxy_config_server_url: http://10.10.10.1:9999/services?Action=GetObProxyConfig
    enable_cluster_checkout: false
    # observer cluster name, consistent with oceanbase-ce's appname. When a depends exists, OBD gets this value from the oceanbase-ce of the depends.
    cluster_name: obcluster
    skip_proxy_sys_private_check: true
    enable_strict_kernel_release: false
    obproxy_sys_password: ***** # obproxy sys user password, can be empty. When a depends exists, OBD gets this value from the oceanbase-ce of the depends.
    observer_sys_password: ***** # proxyro user pasword, consistent with oceanbase-ce's proxyro_password, can be empty. When a depends exists, OBD gets this value from the oceanbase-ce of the depends.
```

您需关注的配置项如下表所示，详细的配置项介绍可参见 [ODP 配置项](https://github.com/oceanbase/obdeploy/blob/master/plugins/obproxy/3.1.0/parameter.yaml)。

|  配置项  |  是否必选  |  默认值  |  说明     |
|----------|-----------|----------|----------|
| servers  | 必选      | 无        | 每台机器需要用 `- name: 机器标识名 (换行)ip: 机器 IP` 指定，多个机器就指定多次，机器标识名不能重复。</br> 在机器 IP 不重复的情况下，也可以使用 `- <ip> （换行）- <ip>` 的格式指定，此时 `- <ip>` 的格式相当于 `- name: 机器 IP（换行）ip: 机器 IP`。 |
| listen_port  | 必选      | 2883        | ODP 监听端口，默认 2883。 |
| prometheus_listen_port  | 必选       | 2884        | ODP prometheus 监听端口，默认 2884。 |
| home_path  | 必选       | 无       | ODP 安装路径，建议在普通用户 admin 下。 |
| rs_list   | 可选   | 无 | OceanBase 集群的 OBServer 节点列表，格式为 `ip:mysql_port;ip:mysql_port`，使用 rs_list 配置部署的情况下您只可代理所配置的这一个集群。<main id="notice" type='notice'><h4>注意</h4><p> <code>rs_list</code> 和 <code>obproxy_config_server_url</code> 配置项只需配置一个即可，若您选择配置 <code>rs_list</code> 配置项，则无需配置 <code>obproxy_config_server_url</code> 配置项。 </p></main>  |
| obproxy_config_server_url | 可选  | 无  | Config Server 的 url，配置后可使用 ODP 代理 Config Server 中注册的所有集群。若未部署 Config Server，您也可使用 `rs_list` 配置项。  |
| enable_cluster_checkout | 可选  | true  | 控制是否需要校验 cluster name，开启后，ODP 会在登陆时发送集群名到 OBServer 节点进行检查。  |
| cluster_name | 可选  | 无   | 表示 ODP 可以代理的 OceanBase 集群的名字，当存在依赖项时，OBD 将会从依赖项 oceanbase-ce 中获取该值。  |
| enable_strict_kernel_release | 必选  | false  | 是否需要校验 OS 内核，如果为 true，则ODP 仅支持 5u/6u/7u 版本的 RedHat。为 false 时不关心 Linux 内核版本的发布，ODP 可能不稳定。  |
| obproxy_sys_password  | 可选      | OBD V2.0.0 及之前版本默认为空</br>OBD V2.1.0 及之后版本默认为随机字符串       | ODP 管理员账户（root@proxysys）的密码。使用 OBD V2.1.0 及之后版本时，未设置的情况下会自动生成随机字符串。 |
| observer_sys_password  | 可选      | OBD V2.0.0 及之前版本默认为空</br>OBD V2.1.0 及之后版本默认为和 `proxyro_password` 相同的随机字符串        | ODP 连接 OceanBase 集群使用的账户名（proxyro@sys）的密码，配置密码需和 `observer_sys_password` 的值相同。使用 OBD V2.1.0 及之后版本时，未设置的情况下会自动生成和 `proxyro_password` 相同的随机字符串。 |

tab OBAgent

此处以 `example/obagent/obagent-only-example.yaml` 文件为例介绍部署 OBAgent 时需注意的配置项。

```yaml
obagent:
  servers:
    # Please don't use hostname, only IP can be supported
    - 10.10.10.1
    - 10.10.10.2
    - 10.10.10.3
  global:
    # The working directory for obagent. obagent is started under this directory. This is a required field.
    home_path: /home/admin/obagent
    # The port of monitor agent. The default port number is 8088.
    monagent_http_port: 8088
    # The port of manager agent. The default port number is 8089.
    mgragent_http_port: 8089
    # Log path. The default value is log/monagent.log.
    log_path: log/monagent.log
    # The log level of manager agent.
    mgragent_log_level: info
    # The total size of manager agent.Log size is measured in Megabytes. The default value is 30M.
    mgragent_log_max_size: 30
    # Expiration time for manager agent logs. The default value is 30 days.
    mgragent_log_max_days: 30
    # The maximum number for manager agent log files. The default value is 15.
    mgragent_log_max_backups: 15
    # The log level of monitor agent.
    monagent_log_level: info
    # The total size of monitor agent.Log size is measured in Megabytes. The default value is 200M.
    monagent_log_max_size: 200
    # Expiration time for monitor agent logs. The default value is 30 days.
    monagent_log_max_days: 30
    # The maximum number for monitor agent log files. The default value is 15.
    monagent_log_max_backups: 15
    # Username for HTTP authentication. The default value is admin.
    http_basic_auth_user: admin
    # Password for HTTP authentication. The default value is root.
    http_basic_auth_password: root
    # Monitor password for OceanBase Database. The default value is empty. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the ocp_agent_monitor_password in oceanbase-ce.
    monitor_password: 
    # The SQL port for observer. The default value is 2881. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the mysql_port in oceanbase-ce.
    sql_port: 2881
    # The RPC port for observer. The default value is 2882. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the rpc_port in oceanbase-ce.
    rpc_port: 2882
    # Cluster name for OceanBase Database. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the appname in oceanbase-ce.
    cluster_name: obcluster
    # Cluster ID for OceanBase Database. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the cluster_id in oceanbase-ce.
    cluster_id: 1
    # The redo dir for Oceanbase Database. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the redo_dir in oceanbase-ce.
    ob_log_path: /home/admin/observer/store
    # The data dir for Oceanbase Database. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the data_dir in oceanbase-ce.
    ob_data_path: /home/admin/observer/store
    # The work directory for Oceanbase Database. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the home_path in oceanbase-ce.
    ob_install_path: /home/admin/observer
    # The log path for Oceanbase Database. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the {home_path}/log in oceanbase-ce.
    observer_log_path: /home/admin/observer/log
    # Monitor status for OceanBase Database.  Active is to enable. Inactive is to disable. The default value is active. When you deploy an cluster automatically, OBD decides whether to enable this parameter based on depends.
    ob_monitor_status: active
    # Synchronize the obagent-related information to the specified path of the remote host, as the targets specified by `file_sd_config` in the Prometheus configuration.
    # For prometheus that depends on obagent, it can be specified to $home_path/targets of prometheus.
    # For independently deployed prometheus, specify the files to be collected by setting `config` -> `scrape_configs` -> `file_sd_configs` -> `files`. For details, please refer to prometheus-only-example.yaml.
    # target_sync_configs:
    #   - host: 10.10.10.4
    #     target_dir: /home/admin/prometheus/targets
    #     username: your username
    #     password: your password if need
    #     key_file: your ssh-key file path if need
    #     port: your ssh port, default 22
    #     timeout: ssh connection timeout (second), default 30
  10.10.10.1:
    # Zone name for your observer. The default value is zone1. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the zone name in oceanbase-ce.
    zone_name: zone1
  10.10.10.2:
    # Zone name for your observer. The default value is zone1. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the zone name in oceanbase-ce.
    zone_name: zone2
  10.10.10.3:
    # Zone name for your observer. The default value is zone1. When a depends exists, OBD gets this value from the oceanbase-ce of the depends. The value is the same as the zone name in oceanbase-ce.
    zone_name: zone3
```

您需关注的配置项如下表所示，详细的配置项介绍可参见 [OBAgent 配置项](https://github.com/oceanbase/obdeploy/blob/master/plugins/obagent/1.3.0/parameter.yaml)。

|  配置项  |  是否必选  |  默认值  |  说明     |
|----------|-----------|----------|----------|
| servers  | 必选      | 无        | 每台机器需要用 `- name: 机器标识名 (换行)ip: 机器 IP` 指定，多个机器就指定多次，机器标识名不能重复。</br> 在机器 IP 不重复的情况下，也可以使用 `- <ip> （换行）- <ip>` 的格式指定，此时 `- <ip>` 的格式相当于 `- name: 机器 IP（换行）ip: 机器 IP`。 |
| home_path  | 必选       | 无       | 组件的工作目录，建议在普通用户 admin 下。 |
| monagent_http_port | 必选  | 8088  | OBAgent 监控服务端口。   |
| mgragent_http_port | 必选  | 8089  | OBAgent 管理服务端口。   |
| log_path    |  必选  | log/monagent.log  | 日志路径。   |
| mgragent_log_level | 可选 | 无  | ob_mgragent 日志级别。  |
| mgragent_log_max_size | 可选 | 30 | ob_mgragent 日志文件大小，单位：MB。  |
| mgragent_log_max_days | 可选 | 30 | ob_mgragent 日志文件最大保留天数。  |
| mgragent_log_max_backups | 可选 | 15 | ob_mgragent 日志文件最大备份数。      |
| monagent_log_level  | 可选  | info  | ob_monagent 日志级别。      |
| monagent_log_max_size | 可选  | 200 | ob_monagent 日志文件大小，单位：MB。 |
| monagent_log_max_days | 可选 | 30 | ob_monagent 日志文件最大保留天数。  |
| monagent_log_max_backups | 可选 | 15 | ob_monagent 日志文件最大备份数。 |
| http_basic_auth_user | 必选 | admin  | HTTP 服务认证用户名。   |
| http_basic_auth_password | 必选  | root | HTTP 服务认证密码。  |
| monitor_password  | 可选  | 空 | OceanBase 数据库监控数据采集用户密码，其值需和 OceanBase 数据库中 `ocp_agent_monitor_password` 配置项相同。  |
| sql_port | 可选 | 2881 | OBServer 节点的 SQL 端口，其值需和 OceanBase 数据库中 `mysql_port` 配置项相同。 |
| rpc_port | 可选 | 2882 | OBServer 节点的 RPC 端口，其值需和 OceanBase 数据库中 `rpc_port` 配置项相同。  |
| cluster_name  | 可选  | obcluster | OceanBase 数据库的集群名，其值需和 oceanbase-ce 组件下的 `appname` 配置项相同。 |
| cluster_id   | 可选 | 1 | OceanBase 数据库 ID，其值需和 oceanbase-ce 组件下的 `cluster_id` 配置项相同。 |
| ob_log_path   | 可选 | 无 | OBServer 节点日志盘路径，其值需和 oceanbase-ce 组件下的 `redo_dir` 配置项相同。  |
| ob_data_path | 可选 | 无 | OBServer 节点数据盘路径，其值需和 oceanbase-ce 组件下的 `data_dir` 配置项相同。  |
| ob_install_path | 可选 | 无 | OBServer 节点安装目录，其值需和 oceanbase-ce 组件下的 `home_path` 配置项相同。 |
| observer_log_path | 可选 | 无 | OBServer 节点安装目录下的日志路径，其值需和 oceanbase-ce 组件下的 `{home_path}/log` 相同。 |
| ob_monitor_status  | 必选      | active      | OceanBase 监控指标采集状态，active 表示开启，inactive 表示关闭。 |
| target_sync_configs | 可选   | 无 | 表示将地址同步至指定远端目录。   |
| zone_name   | 可选  | zone1  | OBServer 节点所在的 Zone 名字。 |

tab Prometheus

此处以 `example/prometheus/prometheus-only-example.yaml` 文件为例介绍部署 Prometheus 时需注意的配置项。

```yaml
prometheus:
  servers:
    - 10.10.10.4
  global:
    # The working directory for prometheus. prometheus is started under this directory. This is a required field.
    home_path: /home/admin/prometheus
    address: 0.0.0.0  # The ip address to bind to. Along with port, corresponds to the `web.listen-address` parameter.
    port: 9090 # The http port to use. Along with address, corresponds to the `web.listen-address` parameter.
    enable_lifecycle: true # Enable shutdown and reload via HTTP request. Corresponds to the `web.enable-lifecycle` parameter.
    data_dir: /home/admin/prometheus/data # Base path for metrics storage. Corresponds to the `storage.tsdb.path` parameter.
    # basic_auth_users:  # Usernames and passwords that have full access to the web server via basic authentication. Corresponds to the `basic_auth_users` parameter.
    #   <username>: <password>  # The format of `basic_auth_users` : the key is the user name and the value is the password.
    # web_config: # Content of Prometheus web service config file. The format is consistent with the file. However, `basic_auth_users` cannot be set in it. Please set `basic_auth_users` above if needed. Corresponds to the `web.config.file` parameter.
    #   tls_server_config:
    #     # Certificate and key files for server to use to authenticate to client.
    #     cert_file: <filename>
    #     key_file: <filename>
    config: # Configuration of the Prometheus service. The format is consistent with the Prometheus config file. Corresponds to the `config.file` parameter.
      rule_files:
        - rules/*rules.yaml
      scrape_configs:
        - job_name: prometheus
          metrics_path: /metrics
          scheme: http
          static_configs:
            - targets:
                - localhost:9090
        - job_name: node
          basic_auth:
            username: ********
            password: ********
          metrics_path: /metrics/node/host
          scheme: http
          file_sd_configs:  # Set the targets to be collected by reading local files. The example is to collect targets corresponding to all yaml files in the 'targets' directory under $home_path.
            - files:
              - 'targets/*.yaml'
        - job_name: ob_basic
          basic_auth:
            username: ********
            password: ********
          metrics_path: /metrics/ob/basic
          scheme: http
          file_sd_configs:
            - files:
              - 'targets/*.yaml'
        - job_name: ob_extra
          basic_auth:
            username: ********
            password: ********
          metrics_path: /metrics/ob/extra
          scheme: http
          file_sd_configs:
            - files:
              - 'targets/*.yaml'
        - job_name: agent
          basic_auth:
            username: **********
            password: ********
          metrics_path: /metrics/stat
          scheme: http
          file_sd_configs:
            - files:
              - 'targets/*.yaml'
    # additional_parameters: # Additional parameters for Prometheus service, among which `web.listen-address`, `web.enable-lifecycle`, `storage.tsdb.path`, `config.file` and `web.config.file` cannot be set. Please set them in the corresponding configuration above if needed.
    # - log.level: debug
```

您需关注的配置项如下表所示，详细的配置项介绍可参见 [Prometheus 配置项](https://github.com/oceanbase/obdeploy/blob/master/plugins/prometheus/2.37.1/parameter.yaml)。

|  配置项  |  是否必选  |  默认值  |  说明     |
|----------|-----------|----------|----------|
| servers  | 必选      | 无        | 每台机器需要用 `- name: 机器标识名 (换行)ip: 机器 IP` 指定，多个机器就指定多次，机器标识名不能重复。</br> 在机器 IP 不重复的情况下，也可以使用 `- <ip> （换行）- <ip>` 的格式指定，此时 `- <ip>` 的格式相当于 `- name: 机器 IP（换行）ip: 机器 IP`。 |
| home_path  | 必选       | 无       | 组件的工作目录，建议在普通用户 admin 下。 |
| address    | 必选     | 0.0.0.0    | Prometheus 监听地址。  |
| port      | 必选    | 9090     | Prometheus 监听端口。  |
| enable_lifecycle  | 必选  | true | 控制是否启用通过 HTTP 请求关闭和重新加载的功能。 |
| data_dir  | 可选  | 无  | 指标存储的基本路径。 |
| basic_auth_users | 可选  | 无 | Prometheus Web 服务的认证信息，键名为用户名，值为密码。  |
| web_config   | 可选 | 无 | Prometheus 的 Web 服务配置，可在其下配置服务器用于向客户端进行身份验证的证书和密钥文件。 |
| config   | 可选  | 无 | Prometheus 的配置，格式与 Prometheus 配置文件一致。对应于 `config.file` 参数。 |
| additional_parameters | 可选 | 无 | Prometheus 启动参数。  |

tab Grafana

此处以 `example/prometheus/grafana-only-example.yaml` 文件为例介绍部署 Grafana 时需注意的配置项。

```yaml
grafana:
  servers:
    - 10.10.10.4
  global:
    home_path: /home/admin/grafana
    login_password: ******** # Grafana login password.
    data_dir: # Path to where grafana can store temp files, sessions, and the sqlite3 db (if that is used).$data_dir can be empty. The default value is $home_path/data.
    logs_dir: # Directory where grafana can store logs, can be empty. The default value is $data_dir/log.
    plugins_dir: # Directory where grafana will automatically scan and look for plugins, can be empty. The default value is $data_dir/plugins.
    provisioning_dir: # folder that contains provisioning config files that grafana will apply on startup and while running, can be empty. The default value is $home_path/conf/provisioning.
    temp_data_lifetime: 24h # How long temporary images in data directory should be kept. Supported modifiers h (hours), m (minutes), Use 0 to never clean up temporary files, can be empty. The default value is 24h.
    log_max_days: 7 # Expired days of log file(delete after max days), can be empty. The default value is 7.
    # domain: # The public facing domain name used to access grafana from a browser, can be empty. The default value is $server.ip.
    # port: # The http port to use, can be empty. The default value is 3000.
    # # list of datasources to insert/update depending on what's available in the database, can be empty.
    # # For more parameter settings, please refer to https://grafana.com/docs/grafana/latest/administration/provisioning/#datasources
    # datasources:
    #   name: # name of the datasource. Required and should not be 'OB-Prometheus'
    #   type: # datasource type. Required
    #   access: # access mode. direct or proxy. Required
    #   url: # the url of datasource
    # list of dashboards providers that load dashboards into Grafana from the local filesystem, can be empty.
    # For more information, please refer to https://grafana.com/docs/grafana/latest/administration/provisioning/#dashboards
    # providers:
    #   name: # an unique provider name. Required and should not be 'OceanBase Metrics'
    #   type: # provider type. Default to 'file'
    #   options:
    #     path: # path to dashboard files on disk. Required when using the 'file' type
    # # customize your Grafana instance by adding/modifying the custom configuration as follows   
    # # for more information, please refer to https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/#configure-grafana
    # # Here, setting parameters is required for format conversion.
    # # For example, if the original grafana configuration format is
    # #
    # # [section1.section2]
    # # key1 = value1
    # # key2 = value2
    # #
    # # Then when writing the configuration below, you need to write it as
    # #
    # # section1:
    # #   section2:
    # #     key1: value1
    # #     key2: value2
    # #
    # # Here we only list one item, because there are more than 500 items. Please add them according to your own needs.
    # customize_config:
    #   # original grafana configuration format is 
    #   # [server] 
    #   # protocol = http
    #   server:
    #     protocol: http  
```

您需关注的配置项如下表所示，详细的配置项介绍可参见 [Grafana 配置项](https://github.com/oceanbase/obdeploy/blob/master/example/grafana/grafana-only-example.yaml)。

|  配置项  |  是否必选  |  默认值  |  说明     |
|----------|-----------|----------|----------|
| servers  | 必选      | 无        | 每台机器需要用 `- name: 机器标识名 (换行)ip: 机器 IP` 指定，多个机器就指定多次，机器标识名不能重复。</br> 在机器 IP 不重复的情况下，也可以使用 `- <ip> （换行）- <ip>` 的格式指定，此时 `- <ip>` 的格式相当于 `- name: 机器 IP（换行）ip: 机器 IP`。 |
| home_path  | 必选       | 无       | 组件的工作目录，建议在普通用户 admin 下。 |
| login_password    | 必选     | OBD V2.0.0 及之前版本默认为空</br>OBD V2.1.0 及之后版本默认为随机字符串    | Grafana 登录密码。  |
| data_dir  | 可选  | $home_path/data  | Grafana 用来存储 sqlite3、临时文件、会话等路径。 |
| logs_dir  | 可选  | $data_dir/log  | Grafana 用来存放日志的目录。 |
| plugins_dir  | 可选  | $data_dir/plugins  | Grafana 自动扫描并查找插件的目录。 |
| provisioning_dir  | 可选  | $home_path/conf/provisioning  | 包含 Grafana 将在启动和运行时应用的配置文件的文件夹。 |
| temp_data_lifetime  | 可选  | 24h  | Grafana 数据目录中的临时图像保留时间。支持的单位有 h(小时)、m(分钟)，配置为 0 时表示从不清理临时文件。 |
| log_max_days  | 可选  | 7  | 日志文件的过期天数阈值，日志文件存放天数达到该值后删除对应日志文件。 |
:::
